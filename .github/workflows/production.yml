name: Build Release App

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: ðŸšš  Prepare System
        uses: actions/setup-node@v1
        with:
          node-version: '14.x'
      - run: |
          sudo apt-get install unzip -y
          sudo apt-get install libc6-dev-i386 lib32z1 -y
          sudo apt-get install default-jdk -y
          sudo apt-get install openjdk-8-jre-headless -y
          sudo apt-get install npm -y
          wget https://dl.google.com/android/repository/commandlinetools-linux-6858069_latest.zip
          unzip commandlinetools-linux-6858069_latest.zip
          rm commandlinetools-linux-6858069_latest.zip
          mkdir $HOME/android-sdk
          mv cmdline-tools $HOME/android-sdk/tools
          $HOME/android-sdk/tools/bin/sdkmanager --sdk_root=$HOME/android-sdk/tools --update
          yes | $HOME/android-sdk/tools/bin/sdkmanager --sdk_root=$HOME/android-sdk/tools "platforms;android-29" "build-tools;29.0.2" "extras;google;m2repository" "extras;android;m2repository"
          yes | $HOME/android-sdk/tools/bin/sdkmanager --sdk_root=$HOME/android-sdk/tools --licenses
          export ANDROID_HOME=$HOME/android-sdk
          echo "export ANDROID_HOME=$HOME/android-sdk
          export PATH=$PATH:$ANDROID_HOME/tools/bin
          export PATH=$PATH:$ANDROID_HOME/platform-tools
          # Fixes sdkmanager error with java versions higher than java 8
          export JAVA_OPTS='-XX:+IgnoreUnrecognizedVMOptions --add-modules java.se.ee'" > ~/.bash_profile
          source ~/.bash_profile
          npm i -g yarn
          npm i -g cordova
          npm i
          yarn cordova:release:full